# 📈 KDAS股票分析工具

一个基于 Streamlit 的智能股票分析工具，支持股票、ETF、指数的K线图和关键日均线（KDAS）指标分析，**配备AI智能推荐功能**。

## ✨ 功能特性

- 🔍 **交互式界面**: 基于 Streamlit 的现代化 Web 界面
- 📊 **多品种支持**: 支持A股股票、ETF、指数三种证券类型
- 📈 **专业图表**: 使用 Plotly 生成交互式 K线图和成交量图
- 🎯 **KDAS指标**: 支持最多5个关键日期的累计成交量加权平均价格计算
- 🤖 **AI智能推荐**: 基于GPT-4o模型的专业KDAS日期推荐（新增）
- 💾 **配置管理**: 自动保存和管理分析配置，支持一键加载
- 🗓️ **交易日历**: 精确跳过非交易日，优化图表显示
- 🎨 **优化展示**: 支撑阻力位分析，图例位于左上角

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

**注意**: AI智能推荐功能需要安装 `openai` 库，已包含在 requirements.txt 中。

### 2. 配置API密钥（可选）

为了使用AI智能推荐功能，需要配置AI API密钥：

#### 方法一：环境变量
```bash
# Windows
set OPENAI_API_KEY=sk-your-api-key-here

# macOS/Linux  
export OPENAI_API_KEY=sk-your-api-key-here
```

#### 方法二：在应用界面中输入
在KDAS应用的侧边栏"🤖 AI智能推荐"区域输入API密钥

#### 获取API密钥
1. 访问 [OpenAI官网](https://platform.openai.com/)
2. 注册并登录账户
3. 进入 API Keys 页面创建新密钥

### 3. 运行应用

#### 方法一：使用启动脚本
```bash
python run_app.py
```

#### 方法二：直接运行 Streamlit
```bash
streamlit run KDAS.py
```

### 4. 使用应用

1. 在浏览器中打开 http://localhost:8501
2. 选择证券类型（股票、ETF、指数）
3. 输入证券代码（如：股票000001、ETF159915、指数000001等）
4. **🤖 推荐方式**: 点击"AI智能推荐日期"让AI分析并推荐最佳日期
5. **手动方式**: 手动选择5个关键的分析日期
6. 点击「🔍 开始分析」按钮
7. 查看生成的交互式图表和数据分析

## 📋 系统要求

- Python 3.7+
- 网络连接（用于获取股票数据）

## 📊 KDAS指标说明

KDAS（Key Date Average Settlement）是基于关键日期的累计成交量加权平均价格指标：

- 从指定的关键日期开始计算累计成交额和成交量
- KDAS = 累计成交额 / 累计成交量 / 100
- 不同颜色的线条表示从不同日期开始计算的KDAS值

## 🎨 界面功能

### 侧边栏
- 股票代码输入
- 5个关键日期选择器（带颜色标识）
- 分析按钮

### 主界面
- 股票基本信息展示（名称、代码、最新价格、涨跌）
- 交互式K线图和KDAS指标图
- 成交量柱状图
- KDAS数据详情表格

### 图表交互功能
- 缩放和平移
- 图例点击切换
- 鼠标悬停显示详细数据
- 十字光标追踪

## 📁 文件结构

```
KDAS/
├── KDAS.py                 # 主应用程序
├── kdas_ai_advisor.py      # AI智能推荐模块（新增）
├── test_ai_advisor.py      # AI功能测试脚本（新增）
├── run_app.py             # 启动脚本
├── requirements.txt       # 依赖包列表
├── readme.md             # 项目说明
├── ai_config_example.md  # AI配置指南（新增）
├── user_configs.json    # 用户配置存储
├── get_index.py         # 其他工具脚本
├── shares/              # 股票数据缓存目录
├── etfs/                # ETF数据缓存目录
└── stocks/              # 指数数据缓存目录
```

## 🤖 AI智能推荐功能

### 核心特性
- **多模型支持**: 支持DeepSeek-R1、Gemini-2.5等多种先进AI模型
- **智能选择**: 用户可根据需求选择不同特点的AI模型
- **技术分析**: 自动分析价格趋势、成交量、支撑阻力位等
- **专业推荐**: 遵循KDAS交易体系原理推荐最佳日期
- **置信度评估**: 提供推荐结果的可信度评级
- **新手友好**: 降低技术分析门槛，无需专业知识

### 分析维度
- 价格统计和波动率分析
- 成交量趋势和异常识别
- 局部高低点和关键价格位
- 短中长期趋势判断
- 支撑阻力位计算

### 支持的AI模型
- **deepseek-r1**: DeepSeek推理模型，逻辑推理能力强，适合复杂技术分析
- **gemini-2.5-flash-preview-05-20**: Google Gemini快速版本，响应速度快，适合日常使用
- **gemini-2.5-pro-preview-03-25**: Google Gemini专业版本，分析更深入，适合重要决策

### 推荐标准
AI优先推荐以下类型的关键日期：
1. **价格突破点** - 突破重要阻力或支撑位
2. **趋势转折点** - 明显的趋势方向变化
3. **成交量异常** - 显著放量的交易日
4. **技术形态** - 重要技术图形形成点
5. **情绪转换** - 市场情绪明显变化时点

## 🔧 技术栈

- **Streamlit**: Web 应用框架
- **多AI模型**: DeepSeek-R1、Gemini-2.5等智能推荐引擎（新增）
- **Plotly**: 交互式图表库
- **AKShare**: 多品种证券数据获取
- **Pandas**: 数据处理和分析
- **Python**: 主要编程语言

## 📞 支持

如有问题或建议，请查看代码中的使用说明或联系开发者。
